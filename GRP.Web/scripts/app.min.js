function beforeUnloadPage(n){if(!forceRedirect){var t=openedFrmsChanges.filter(function(n){return n.hasChanges==!0});if(t!=null&&t.length>0)return n||(n=window.event),n.cancelBubble=!0,n.returnValue="توجد بعض التعديلات التي لم يتم حفظها, اغلاق ؟",n.stopPropagation&&(n.stopPropagation(),n.preventDefault()),"توجد بعض التعديلات التي لم يتم حفظها, اغلاق ؟"}}function isEquivalent(n,t,i){var f=Object.getOwnPropertyNames(n),e=Object.getOwnPropertyNames(t),u,r;if(f.length!=e.length)return!1;for(u=0;u<f.length;u++)if(r=f[u],i){if(n[r]!==t[r])return!1}else if(n[r]!=t[r])return!1;return!0}function zeroPad(n,t){var i=t-n.toString().length+1;return Array(+(i>0&&i)).join("0")+n}function blinkText(n){$(n).fadeOut(700,function(){$(this).fadeIn(700,function(){blinkText(this)})})}function formatHijriDateInput(n){var i,r,u,t;return i=n.substr(n.length-4,4),t=n.replace(i,""),t.length==2?(u=zeroPad(t.substr(0,1),2),r=zeroPad(t.substr(0,1),2)):(u=t.substr(0,2),r=t.substr(2,2)),i+"/"+r+"/"+u}function parsetHijriDateInput(n){return n.indexOf("/")>-1?zeroPad(n.split("/")[2],2)+zeroPad(n.split("/")[1],2)+n.split("/")[0]:n}function doAjax(n,t,i,r,u,f){$.ajax({type:t,url:n,data:i,contentType:r,success:function(n,t,i){var r=i.getResponseHeader("X-Responded-JSON");r&&JSON.parse(r).status==401&&(forceRedirect=!0,window.location.replace(window.location+"User/Login"));u(n)},error:function(n,t,i){f&&f(i)}})}function showProgress(n,t){$(n).block({message:t,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}})}function hideProgress(n){$(n).unblock()}function showMessage(n){doAjax("App/GetSysMsg","get",{msgCode:n},"application/json",function(n){n.charAt(0)==='"'&&n.charAt(n.length-1)==='"'&&(n=n.slice(1,n.length-1));var t;switch(n.split("|")[0]){case"خطأ":t="error";break;case"تنبيه":t="info"}$.messager.alert(n.split("|")[0],n.split("|")[1],t)})}function showAlert(n,t,i,r,u){$.messager.alert({title:n,msg:t,icon:i,fn:r,width:u?u:300})}function showConfirm(n,t,i){$.messager.confirm(n,t,i)}function showConfirm3B(n,t,i){confirm3BCBFunc=i;$("#divGSysAlertText").html(t);$("#divGSysAlert").window({modal:!0,title:n,collapsible:!1,minimizable:!1,maximizable:!1,closable:!1,iconCls:"icon-save",footer:"#divGSysAlertFt"})}function closeConfirm3BYNCEH(n){$("#divGSysAlert").window("close");confirm3BCBFunc(n)}function getCurrentFormChangesObj(){return openedFrmsChanges.filter(function(n){return n.frmId==currentOpenedFrmId})[0]}function initUILayout(){$("#txtGSysTreeFilter").textbox({icons:[{iconCls:"icon-clear",handler:function(n){$(n.data.target).textbox("clear");$("#ulSysTree").tree("doFilter","");$("#ulSysTree").tree("collapseAll")}}]}).textbox("textbox").bind("keydown",function(){$(this).val()==""?$("#ulSysTree").tree("collapseAll"):($("#ulSysTree").tree("doFilter",$(this).val()),$("#ulSysTree").tree("expandAll"))})}function openRefUrl(n){doAjax("App/GetRefUrl","get",{fpu:n},"application/json",function(n){n.res==1?openFormFromTree(n.resCon,n.resUrl,function(){history.pushState?history.replaceState({},document.title,location.protocol+"//"+location.host+location.pathname):location.hash=""}):showAlert("عنوان خاطئ","العنوان الذي تحاول الوصول إليه خطأ او غير موجود بالنظام <br> Err Code :"+n.resCon,"error")})}function initTabs(){$("#apptbs").tabs({onSelect:function(n){document.title=n+" - "+document.title.split("-")[1];var t=openedFrmsChanges.filter(function(n){return n.frmId==currentOpenedFrmId});t!=null&&t.length>0&&(currentOpenedFrmId=t[0].frmId)},onBeforeClose:function(n,t){var i=openedFrmsChanges.filter(function(n){return n.frmId==currentOpenedFrmId}),r;if(i!=null&&i.length>0&&(r=this,i[0].hasChanges))return showConfirm3B("تنبيه","توجد بعض التعديلات لم يتم حفظها في "+n+'<br/><br/><div style="width:100%;text-align:center;">هل تريد حفظ التغيرات؟<\/div>',function(n){var u,f;n=="y"&&i[0].beforeCloseSaveChangesEV?i[0].beforeCloseSaveChangesEV(function(){u=$(r).tabs("options");f=u.onBeforeClose;u.onBeforeClose=function(){};$(r).tabs("close",t);u.onBeforeClose=f}):n=="n"&&(u=$(r).tabs("options"),f=u.onBeforeClose,u.onBeforeClose=function(){},$(r).tabs("close",t),u.onBeforeClose=f)}),!1},onLoad:function(n){$(n).find('.easyui-textbox[data-options*="editable:false"], .easyui-numberbox[data-options*="editable:false"]').each(function(){$(this).next("span").first().skipOnTab()})},onClose:function(){openedFrmsChanges=openedFrmsChanges.filter(function(n){return n.frmId!==currentOpenedFrmId});currentOpenedFrmId=null}})}function initTree(){$(g_treeCtrlId).tree({url:"App/UserSys",onClick:function(n){openFormFromTree(n.id)}})}function openFormFromTree(n,t,i){var r=$(g_treeCtrlId).tree("find",n),e,o,s,f,u;r?(e=$(g_treeCtrlId).tree("isLeaf",r.target),e?r.attributes!=null&&($(g_tabCtrlId).tabs("tabs").length==7?showMessage(33):(o=$(g_tabCtrlId).tabs("getTab",r.text),o?($(g_tabCtrlId).tabs("select",r.text),s=$(g_tabCtrlId).tabs("getTabIndex",$(g_tabCtrlId).tabs("getSelected")),f=openedFrmsChanges.filter(function(n){return n.tIndex==s}),currentOpenedFrmId=f!=null&&f.length>0?f[0].frmId:null,$("#grpAppBody").layout("collapse","east")):r.attributes.toString().startsWith("ORA")?doAjax("App/GetOUrl","get",null,"text/html",function(n){$(g_tabCtrlId).tabs("add",{title:r.text,content:'<iframe src="'+n.replace("frm.fmx",r.attributes.toString().split("|")[2]).replace("frmid",r.attributes.toString().split("|")[1])+'" style="width:100%;height:98%;z-index:0;"><\/iframe>',selected:!0,closable:!0})}):r.attributes.toString().startsWith("NET")?(u=r.attributes.toString().split("|"),$("#grpAppBody").layout("collapse","east"),$(g_tabCtrlId).tabs("add",{title:r.text,href:t?t:u[3],selected:!0,closable:!0,onLoadError:function(){alert("Error Loading Form")},onLoad:function(){i&&i()},extractor:function(n){if(n)return n;forceRedirect=!0;window.location.replace(window.location+"User/Login")}}),u[4].toLowerCase()=="frm"&&(currentOpenedFrmId=u[1],openedFrmsChanges.push({frmId:u[1],tIndex:$(g_tabCtrlId).tabs("getTabIndex",$(g_tabCtrlId).tabs("getSelected")),hasChanges:!1}))):r.attributes.toString().startsWith("DEV")&&showMessage(32))):$(g_treeCtrlId).tree(r.state=="closed"?"expand":"collapse",r.target)):t&&i&&i()}function closeTab(){var n=$(g_tabCtrlId).tabs("getSelected"),t;n&&(t=$(g_tabCtrlId).tabs("getTabIndex",n),$(g_tabCtrlId).tabs("close",t))}function resetObject(n){for(var t in n)n.hasOwnProperty(t)&&(n[t]=null)}function openFormWithId(n,t){$(g_tabCtrlId).tabs("add",{title:"Id number : "+t,href:n+t,selected:!0,closable:!0,method:"post",queryParams:{reqId:t},extractor:function(n){if(n)return n;forceRedirect=!0;window.location.replace(window.location+"User/Login")}})}function treeGetAllParentsOfNode(n){var t=$(n).tree("getSelected"),i=$(n).tree("getLevel",t.target);return treeGetParentArray(n,t,i,[])}function treeGetParentArray(n,t,i,r){if(i==1)return r;i-=1;var u=$(n).tree("getParent",t.target);return r.unshift(u),treeGetParentArray(n,u,i,r)}function getTodayDatesText(){var n=new Date,i=n.getDate()+" "+["يناير","فبراير","مارس","إبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"][n.getMonth()]+" "+n.getFullYear(),t=_gsAppHDP.gHDate(n),r=t.day+" "+["محرم","صفر","ربيع الأول","ربيع الثاني","جمادى الأول","جمادى الآخر","رجب","شعبان","رمضان","شوال","ذو القعدة","ذو الحجة"][t.month-1]+" "+t.year;return["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][n.getDay()]+" "+r+" هـ  - "+i+" م"}function initUISystem(n,t){t==null?window.location.replace(window.location+"User/Logout"):(initUILayout(),initTabs(),initTree(),$("#sysClock").thooClock({size:200,rtl:!0}),showUserNotifications(n),initNotifications(),_gsAppHDP=new HijriDateProcessor(t.hyl,t.chd),$("#spnGSTodayDatesTxt").text(getTodayDatesText()),document.location.href.indexOf("#")>-1&&openRefUrl(document.location.href.split("#")[1]))}function HijriDateProcessor(n,t){this.hYears=n;this.cDate=t;this.year=function(){return parseInt(this.cDate.substr(0,4))};this.month=function(){return parseInt(this.cDate.substr(4,2))};this.day=function(){return parseInt(this.cDate.substr(6,2))};this.isValidStrDate=function(n){if(n){if(n.indexOf("/")==-1)return!1;var t=n.split("/");return t.length==3?t[0].length==4&&t[1].length==2&&t[2].length==2?!0:!1:!1}return!1};this.gDateFromStr=function(n){var t=n.split("/"),i=this.gDate(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]));return i.getFullYear()+"/"+zeroPad(i.getMonth()+1,2)+"/"+zeroPad(i.getDate(),2)};this.gDate=function(n,t,i){var u=this,f=$.grep(this.hYears,function(t){return t.year==(n?n:u.year())})[0],r;if(f){for(var e=0,o=1,s=parseInt(t),h=parseInt(i);o<(t?s:u.month());)e+=f["mon"+zeroPad(o,2)],o++;return e+=i?h:u.day(),r=new Date(parseInt(f.jDate.replace("/Date(",""))),r.setDate(r.getDate()+(e-1)),r}return new Date};this.gDay=function(n,t,i){var i=this.gDate(n,t,i);return i.getDay()};this.isYearExist=function(n){return $.grep(this.hYears,function(t){return t.year==n}).length>0};this.gMonthDays=function(n,t){return n.length!=4&&(n=this.year()),$.grep(this.hYears,function(t){return t.year==n})[0]["mon"+zeroPad(t,2)]};this.gHDateString=function(n,t,i){var o=new Date(n,t,i),e=this,u,s=$.grep(e.hYears,function(n){return g_checkDateIn(new Date(parseInt(n.jDate.replace("/Date(",""))),g_addDays(new Date(parseInt(n.jDate.replace("/Date(",""))),n.totalHDays),o)}),f,r;for(u=s?s[0]:$.grep(e.hYears,function(t){return t.year==(n?n:e.year())})[0],f=Math.floor((o-new Date(parseInt(u.jDate.replace("/Date(",""))))/864e5)+1,r=1;r<=12;){if(f<=u["mon"+zeroPad(r,2)])break;else f-=u["mon"+zeroPad(r,2)];r++}return u.year+""+zeroPad(r,2)+""+zeroPad(f,2)};this.gHDate=function(n){var u=this,i,f=$.grep(u.hYears,function(t){return g_checkDateIn(new Date(parseInt(t.jDate.replace("/Date(",""))),g_addDays(new Date(parseInt(t.jDate.replace("/Date(",""))),t.totalHDays),n)}),r,t;for(i=f?f[0]:$.grep(u.hYears,function(n){return n.year==(y?y:u.year())})[0],r=Math.floor((n-new Date(parseInt(i.jDate.replace("/Date(",""))))/864e5)+1,t=1;t<=12;){if(r<=i["mon"+zeroPad(t,2)])break;else r-=i["mon"+zeroPad(t,2)];t++}return{year:i.year,month:t,day:r}};this.getArabicDayText=function(n){var t="",i=this.gDay(n.split("/")[0],n.split("/")[1],n.split("/")[2]);switch(parseInt(i)){case 0:t="الأحد";break;case 1:t="الإثنين";break;case 2:t="الثلاثاء";break;case 3:t="الأربعاء";break;case 4:t="الخميس";break;case 5:t="الجمعة";break;case 6:t="السبت"}return t}}function g_addDays(n,t){return new Date(n.getFullYear(),n.getMonth(),n.getDate()+t,n.getHours(),n.getMinutes(),n.getSeconds())}function g_checkDateIn(n,t,i){return i<=t&&i>=n?!0:!1}var openedFrmsChanges=[],currentOpenedFrmId=null,confirm3BCBFunc,forceRedirect=!1,_gsAppHDP;window.onbeforeunload=beforeUnloadPage;typeof String.prototype.startsWith!="function"&&(String.prototype.startsWith=function(n){return this.indexOf(n)===0});String.prototype.replaceAll=function(n,t){return this.split(n).join(t)};var appPath=location.pathname.split("/")[1],g_treeCtrlId="#ulSysTree",g_tabCtrlId="#apptbs";$.extend($.fn.combobox.defaults.inputEvents,{focus:function(){var n=this,t=$(n).val().length;setTimeout(function(){if(n.setSelectionRange)n.setSelectionRange(0,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse();i.moveEnd("character",t);i.moveStart("character",0);i.select()}},0)}});$.extend($.fn.combobox.defaults,{onLoadSuccess:function(n){var t=null,i,r;if(t=!n||n instanceof Array?this:n,$(t).combobox("options").mode=="remote"){i=$(t).combobox("options").valueField;r=$(t).combobox("options").textField;$(".combobox-item-selected").on("click",function(){var u=this.textContent,n=$(t).combobox("getData").filter(function(n){return n[r]==u});n.length==1&&($(t).combobox("unselect",n[0][i]),$(t).combobox("select",n[0][i]))})}}});$.extend($.fn.validatebox.defaults.rules,{onlyMobileNum:{validator:function(n){return n.match(/[0-9]/)&&n.length>8},message:"ادخل رقم جوال صحيح"}});$.extend($.fn.tree.methods,{getLevel:function(n,t){return $(t).find("span.tree-indent,span.tree-hit").length},unselect:function(n,t){return n.each(function(){var n=$(this).tree("options");$(t).removeClass("tree-node-selected");n.onUnselect&&n.onUnselect.call(this,$(this).tree("getNode",t))})}});